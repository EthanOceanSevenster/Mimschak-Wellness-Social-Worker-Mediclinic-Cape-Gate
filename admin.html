<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="robots" content="noindex, nofollow">
	<link rel="shortcut icon" href="favicon.png">
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<title>Admin | Mimschak Wellness</title>
	<style>
		.admin-container {
			min-height: 100vh;
			background: #f8f9fa;
		}
		.login-box {
			max-width: 400px;
			margin: 100px auto;
			padding: 40px;
			background: white;
			border-radius: 20px;
			box-shadow: 0 10px 40px rgba(0,0,0,0.1);
		}
		.admin-panel {
			display: none;
			padding: 30px 0;
		}
		.booking-card {
			background: white;
			border-radius: 15px;
			padding: 20px;
			margin-bottom: 15px;
			box-shadow: 0 5px 20px rgba(0,0,0,0.05);
			border-left: 4px solid #1F86C7;
		}
		.booking-card.confirmed {
			border-left-color: #8BC34A;
		}
		.booking-card.cancelled {
			border-left-color: #dc3545;
			opacity: 0.7;
		}
		.booking-card h5 {
			margin-bottom: 10px;
			color: #333;
		}
		.booking-card .meta {
			font-size: 14px;
			color: #666;
		}
		.booking-card .meta i {
			width: 20px;
			color: #1F86C7;
		}
		.booking-card .actions {
			margin-top: 15px;
			padding-top: 15px;
			border-top: 1px solid #eee;
		}
		.booking-card .actions .btn {
			padding: 5px 15px;
			font-size: 13px;
		}
		.status-badge {
			display: inline-block;
			padding: 3px 10px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 600;
		}
		.status-badge.pending {
			background: #fff3cd;
			color: #856404;
		}
		.status-badge.confirmed {
			background: #d4edda;
			color: #155724;
		}
		.status-badge.cancelled {
			background: #f8d7da;
			color: #721c24;
		}
		.stats-card {
			background: white;
			border-radius: 15px;
			padding: 20px;
			text-align: center;
			box-shadow: 0 5px 20px rgba(0,0,0,0.05);
		}
		.stats-card h3 {
			font-size: 32px;
			color: #1F86C7;
			margin-bottom: 5px;
		}
		.stats-card p {
			margin: 0;
			color: #666;
			font-size: 14px;
		}
		.filter-bar {
			background: white;
			padding: 15px 20px;
			border-radius: 10px;
			margin-bottom: 20px;
		}
		.no-bookings {
			text-align: center;
			padding: 60px 20px;
			color: #999;
		}
		.no-bookings i {
			font-size: 60px;
			margin-bottom: 20px;
			color: #ddd;
		}
		.admin-header {
			background: linear-gradient(135deg, #1F86C7 0%, #6FB6E6 100%);
			padding: 20px 0;
			color: white;
		}
		.admin-header h1 {
			margin: 0;
			font-size: 24px;
		}
	</style>
</head>
<body>
	<div class="admin-container">
		<!-- Login Box -->
		<div class="login-box" id="loginBox">
			<div class="text-center mb-4">
				<i class="fas fa-lock" style="font-size: 48px; color: #1F86C7;"></i>
				<h3 class="mt-3" style="color: #333;">Admin Login</h3>
				<p class="text-muted">Enter password to access bookings</p>
			</div>
			<div class="mb-3">
				<input type="password" class="form-control" id="adminPassword" placeholder="Password" onkeypress="if(event.key === 'Enter') login()">
			</div>
			<button class="btn btn-primary w-100" onclick="login()">
				<i class="fas fa-sign-in-alt me-2"></i>Login
			</button>
			<p class="text-center mt-3 mb-0">
				<a href="index.html" style="color: #666; font-size: 14px;"><i class="fas fa-arrow-left me-1"></i>Back to Website</a>
			</p>
		</div>

		<!-- Admin Panel -->
		<div class="admin-panel" id="adminPanel">
			<div class="admin-header">
				<div class="container">
					<div class="d-flex justify-content-between align-items-center">
						<h1><i class="fas fa-calendar-alt me-2"></i>Booking Management</h1>
						<div>
							<a href="index.html" class="btn btn-light btn-sm me-2"><i class="fas fa-home me-1"></i>Website</a>
							<button class="btn btn-outline-light btn-sm" onclick="logout()"><i class="fas fa-sign-out-alt me-1"></i>Logout</button>
						</div>
					</div>
				</div>
			</div>

			<div class="container mt-4">
				<!-- Stats -->
				<div class="row mb-4">
					<div class="col-6 col-md-3 mb-3">
						<div class="stats-card">
							<h3 id="totalBookings">0</h3>
							<p>Total Bookings</p>
						</div>
					</div>
					<div class="col-6 col-md-3 mb-3">
						<div class="stats-card">
							<h3 id="pendingBookings" style="color: #ffc107;">0</h3>
							<p>Pending</p>
						</div>
					</div>
					<div class="col-6 col-md-3 mb-3">
						<div class="stats-card">
							<h3 id="confirmedBookings" style="color: #8BC34A;">0</h3>
							<p>Confirmed</p>
						</div>
					</div>
					<div class="col-6 col-md-3 mb-3">
						<div class="stats-card">
							<h3 id="todayBookings" style="color: #17a2b8;">0</h3>
							<p>Today</p>
						</div>
					</div>
				</div>

				<!-- Filter Bar -->
				<div class="filter-bar d-flex flex-wrap align-items-center gap-3">
					<div>
						<select class="form-control" id="filterStatus" onchange="renderBookings()">
							<option value="all">All Status</option>
							<option value="pending">Pending</option>
							<option value="confirmed">Confirmed</option>
							<option value="cancelled">Cancelled</option>
						</select>
					</div>
					<div>
						<input type="date" class="form-control" id="filterDate" onchange="renderBookings()">
					</div>
					<div class="ms-auto">
						<button class="btn btn-outline-danger btn-sm" onclick="clearAllBookings()">
							<i class="fas fa-trash me-1"></i>Clear All
						</button>
						<button class="btn btn-outline-secondary btn-sm" onclick="exportBookings()">
							<i class="fas fa-download me-1"></i>Export
						</button>
					</div>
				</div>

				<!-- Bookings List -->
				<div id="bookingsList">
					<!-- Generated by JS -->
				</div>
			</div>
		</div>
	</div>

	<script>
		// Simple password (change this!)
		const ADMIN_PASSWORD = 'mimschak2024';

		function login() {
			const password = document.getElementById('adminPassword').value;
			if (password === ADMIN_PASSWORD) {
				sessionStorage.setItem('adminLoggedIn', 'true');
				showAdminPanel();
			} else {
				alert('Incorrect password');
			}
		}

		function logout() {
			sessionStorage.removeItem('adminLoggedIn');
			document.getElementById('loginBox').style.display = 'block';
			document.getElementById('adminPanel').style.display = 'none';
		}

		function showAdminPanel() {
			document.getElementById('loginBox').style.display = 'none';
			document.getElementById('adminPanel').style.display = 'block';
			renderBookings();
			updateStats();
		}

		function getBookings() {
			return JSON.parse(localStorage.getItem('mimschakBookings') || '[]');
		}

		function saveBookings(bookings) {
			localStorage.setItem('mimschakBookings', JSON.stringify(bookings));
		}

		function updateStats() {
			const bookings = getBookings();
			const today = new Date().toISOString().split('T')[0];

			document.getElementById('totalBookings').textContent = bookings.length;
			document.getElementById('pendingBookings').textContent = bookings.filter(b => b.status === 'pending').length;
			document.getElementById('confirmedBookings').textContent = bookings.filter(b => b.status === 'confirmed').length;
			document.getElementById('todayBookings').textContent = bookings.filter(b => b.date === today).length;
		}

		function renderBookings() {
			const bookings = getBookings();
			const filterStatus = document.getElementById('filterStatus').value;
			const filterDate = document.getElementById('filterDate').value;

			let filtered = bookings;

			if (filterStatus !== 'all') {
				filtered = filtered.filter(b => b.status === filterStatus);
			}

			if (filterDate) {
				filtered = filtered.filter(b => b.date === filterDate);
			}

			// Sort by date (newest first)
			filtered.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

			const container = document.getElementById('bookingsList');

			if (filtered.length === 0) {
				container.innerHTML = `
					<div class="no-bookings">
						<i class="fas fa-calendar-times"></i>
						<h4>No Bookings Found</h4>
						<p>No bookings match your current filters.</p>
					</div>
				`;
				return;
			}

			container.innerHTML = filtered.map(booking => `
				<div class="booking-card ${booking.status}">
					<div class="d-flex justify-content-between align-items-start">
						<div>
							<h5><i class="fas fa-user me-2"></i>${booking.name}</h5>
							<span class="status-badge ${booking.status}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span>
						</div>
						<div class="text-end">
							<strong style="color: #1F86C7;">${booking.dateDisplay}</strong><br>
							<span class="text-muted">${booking.timeDisplay}</span>
						</div>
					</div>
					<div class="meta mt-3">
						<p class="mb-1"><i class="fas fa-phone"></i> ${booking.phone}</p>
						${booking.email ? `<p class="mb-1"><i class="fas fa-envelope"></i> ${booking.email}</p>` : ''}
						<p class="mb-1"><i class="fas fa-tag"></i> ${booking.sessionTypeText}</p>
						${booking.notes ? `<p class="mb-0"><i class="fas fa-sticky-note"></i> ${booking.notes}</p>` : ''}
					</div>
					<div class="actions">
						${booking.status === 'pending' ? `
							<button class="btn btn-success btn-sm" onclick="updateStatus(${booking.id}, 'confirmed')">
								<i class="fas fa-check me-1"></i>Confirm
							</button>
							<button class="btn btn-danger btn-sm" onclick="updateStatus(${booking.id}, 'cancelled')">
								<i class="fas fa-times me-1"></i>Cancel
							</button>
						` : ''}
						${booking.status === 'confirmed' ? `
							<button class="btn btn-warning btn-sm" onclick="updateStatus(${booking.id}, 'pending')">
								<i class="fas fa-undo me-1"></i>Mark Pending
							</button>
						` : ''}
						${booking.status === 'cancelled' ? `
							<button class="btn btn-secondary btn-sm" onclick="updateStatus(${booking.id}, 'pending')">
								<i class="fas fa-redo me-1"></i>Restore
							</button>
						` : ''}
						<a href="https://wa.me/${booking.phone.replace(/\D/g, '')}" target="_blank" class="btn btn-outline-success btn-sm">
							<i class="fab fa-whatsapp me-1"></i>WhatsApp
						</a>
						<button class="btn btn-outline-danger btn-sm" onclick="deleteBooking(${booking.id})">
							<i class="fas fa-trash"></i>
						</button>
					</div>
				</div>
			`).join('');
		}

		function updateStatus(id, status) {
			const bookings = getBookings();
			const index = bookings.findIndex(b => b.id === id);
			if (index !== -1) {
				bookings[index].status = status;
				saveBookings(bookings);
				renderBookings();
				updateStats();
			}
		}

		function deleteBooking(id) {
			if (confirm('Are you sure you want to delete this booking?')) {
				const bookings = getBookings().filter(b => b.id !== id);
				saveBookings(bookings);
				renderBookings();
				updateStats();
			}
		}

		function clearAllBookings() {
			if (confirm('Are you sure you want to delete ALL bookings? This cannot be undone.')) {
				localStorage.removeItem('mimschakBookings');
				renderBookings();
				updateStats();
			}
		}

		function exportBookings() {
			const bookings = getBookings();
			if (bookings.length === 0) {
				alert('No bookings to export');
				return;
			}

			let csv = 'Name,Phone,Email,Date,Time,Session Type,Status,Notes,Created\n';
			bookings.forEach(b => {
				csv += `"${b.name}","${b.phone}","${b.email || ''}","${b.dateDisplay}","${b.timeDisplay}","${b.sessionTypeText}","${b.status}","${b.notes || ''}","${new Date(b.createdAt).toLocaleString()}"\n`;
			});

			const blob = new Blob([csv], { type: 'text/csv' });
			const url = window.URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'mimschak-bookings-' + new Date().toISOString().split('T')[0] + '.csv';
			a.click();
		}

		// Check if already logged in
		if (sessionStorage.getItem('adminLoggedIn') === 'true') {
			showAdminPanel();
		}
	</script>
</body>
</html>
